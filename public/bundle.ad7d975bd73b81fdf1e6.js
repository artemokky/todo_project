(()=>{"use strict";class t{id;description;status;html;constructor(t,e,n){this.id=t,this.status=n,this.html=function(t){const e=document.createElement("li");e.id=t.id,e.className="task_in_list";const n=document.createElement("div");n.className="task",n.id=t.id;const s=document.createElement("input");s.id=t.id,s.type="checkbox",s.className="task_status",s.ariaLabel="Отметить задачу";const o=document.createElement("label");o.className="task_status_icon",o.htmlFor=t.id;const a=document.createElement("span");a.className="task_text",a.textContent=t.description;const i=document.createElement("input");return i.type="button",i.className="delete_btn",i.title="Удалить задачу",!0===t.status&&(a.className+=" done",s.checked=!0),n.append(s,o,a,i),e.append(n),e}({id:t,description:e,status:n}),this.description=e}get description(){return this.description}set description(t){this.description=t}get id(){return this.id}set id(t){this.id=t}get status(){return this.status}set status(t){this.status=t}get html(){return this.html}}class e{static post(t,e){return fetch(`https://todo-app-ac6eb-default-rtdb.firebaseio.com/${t}.json`,{method:"POST",body:JSON.stringify(e),headers:{content:"app/json"}}).then((t=>t.json()))}static get(t){return fetch(`https://todo-app-ac6eb-default-rtdb.firebaseio.com/${t}.json`,{method:"GET",headers:{content:"app/json"}}).then((t=>t.json())).then((t=>t?Object.keys(t).map((e=>({...t[e],id:e}))):[]))}static delete(t,e){fetch(`https://todo-app-ac6eb-default-rtdb.firebaseio.com/${t}/${e}.json`,{method:"DELETE",headers:{content:"app/json"}}).then((t=>t.json())).then((t=>{console.log(t)}))}static update(t,e,n){return fetch(`https://todo-app-ac6eb-default-rtdb.firebaseio.com/${t}/${e}.json`,{method:"PUT",body:JSON.stringify(n),headers:{content:"app/json"}}).then((t=>t.json())).then((t=>{console.log(t)}))}}class n{static post(t){return fetch("https://todo-app-ac6eb-default-rtdb.firebaseio.com/users.json",{method:"POST",body:JSON.stringify(t),headers:{content:"app/json"}}).then((t=>t.json()))}static get(){return fetch("https://todo-app-ac6eb-default-rtdb.firebaseio.com/users.json",{method:"GET",headers:{content:"app/json"}}).then((t=>t.json())).then((t=>t?Object.keys(t).map((e=>({...t[e],id:e}))):[]))}static update(t,e){return fetch(`https://todo-app-ac6eb-default-rtdb.firebaseio.com/users/${t}.json`,{method:"PUT",body:JSON.stringify(e),headers:{content:"app/json"}}).then((t=>t.json())).then((t=>{console.log(t)}))}}class s{static showTasks(t,e,n,s,o){s.innerHTML="",o.forEach((o=>{(t.checked||e.checked&&!1===o.status||n.checked&&!0===o.status)&&s.appendChild(o.html)}))}static updateCounter(t,e){let n=0;e.forEach((t=>{!1===t.status&&n++})),t.textContent=n.toString()+" items left"}static changeAuthStatusLogIn(t){const e=document.getElementById("modal_button"),n=document.getElementById("register_button"),s=document.getElementById("logout_button");e.style.position="absolute",e.style.visibility="hidden",n.style.position="absolute",n.style.visibility="hidden",s.style.visibility="visible",s.style.position="absolute",document.getElementById("owner_name").textContent=t+" todo's"}static changeAuthStatusLogOut(){const t=document.getElementById("modal_button"),e=document.getElementById("register_button"),n=document.getElementById("logout_button");n.style.visibility="hidden",n.style.position="static",e.style.position="static",e.style.visibility="visible",t.style.position="static",t.style.visibility="visible",document.getElementById("owner_name").textContent="Common todo's"}}!function(){if("function"==typeof window.CustomEvent)return!1;window.CustomEvent=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}}();const o=function(t){var e,n,s,o=!1,a=!1,i=200;function d(){o=!0,e.classList.remove("modal__show"),e.classList.add("modal__hiding"),setTimeout((function(){e.classList.remove("modal__hiding"),o=!1}),i),document.dispatchEvent(s)}function c(t){"modal"===t.target.dataset.dismiss&&d()}return e=function(t){var e,n=document.createElement("div"),s="";if(n.classList.add("modal"),e=(e='<div class="modal__backdrop" data-dismiss="modal"><div class="modal__content"><div class="modal__header"><div class="modal__title" data-modal="title">{{title}}</div><span class="modal__btn-close" data-dismiss="modal" title="Закрыть">×</span></div><div class="modal__body" data-modal="content">{{content}}</div>{{footer}}</div></div>'.replace("{{title}}",t.title||"Новое окно")).replace("{{content}}",t.content||""),t.footerButtons){for(var o=0,a=t.footerButtons.length;o<a;o++){var i='<button type="button" class="{{button_class}}" data-handler={{button_handler}}>{{button_text}}</button>'.replace("{{button_class}}",t.footerButtons[o].class);s+=i=(i=i.replace("{{button_handler}}",t.footerButtons[o].handler)).replace("{{button_text}}",t.footerButtons[o].text)}s='<div class="modal__footer">{{buttons}}</div>'.replace("{{buttons}}",s)}return e=e.replace("{{footer}}",s),n.innerHTML=e,document.body.appendChild(n),n}(t||{}),e.addEventListener("click",c),n=new CustomEvent("show.modal",{detail:e}),s=new CustomEvent("hide.modal",{detail:e}),{show:function(){a||o||(e.classList.add("modal__show"),document.dispatchEvent(n))},hide:d,destroy:function(){e.parentElement.removeChild(e),e.removeEventListener("click",c),a=!0},setContent:function(t){e.querySelector('[data-modal="content"]').innerHTML=t},setTitle:function(t){e.querySelector('[data-modal="title"]').innerHTML=t}}};class a{id;name;password;constructor(t,e,n){this.id=t,this.name=e,this.password=n}get id(){return this.id}get name(){return this.name}}const i="storage";let d=i;const c=new Map,l=function(t){const e="btn_login";return{modalWindow:o({title:"Authorization",content:'<p><div>\n    <input type="text" class="input_username_auth" placeholder="Enter your name here" id="input_username_auth">\n    </div>\n    <div>\n        <input type="password" class="input_password_auth" placeholder="Enter your password here" id="input_password_auth">\n    </div>\n    </p>',footerButtons:[{class:`${e}`,text:"Log in",handler:"modalHandlerOk"}]}),btnName:e}}(),r=function(t){const e="btn_register";return{modalWindow:o({title:"Registration",content:'<p><div>\n    <input type="text" class="input_username_reg" placeholder="Enter your name here" id="input_username_reg">\n    </div>\n    <div>\n        <input type="password" class="input_password_reg" placeholder="Enter your password here" id="input_password_reg">\n    </div>\n    </p>',footerButtons:[{class:`${e}`,text:"Register",handler:"modalHandlerOk"}]}),btnName:e}}(),u=document.getElementById("modal_button"),m=document.getElementById("register_button"),p=document.getElementById("logout_button"),h=document.querySelector(".todo-app__task-list"),_=document.querySelector(".actions-bar__active-counter"),b=document.querySelector(".todo-app__create-new"),v=document.querySelector(".todo-app__select-all"),f=document.getElementById("show_all"),g=document.getElementById("show_active"),y=document.getElementById("show_completed"),E=document.querySelector(".clear_completed");async function w(){c.clear(),(await e.get(d)).forEach((e=>{c.set(e.id,new t(e.id,e.description,e.status))})),s.showTasks(f,g,y,h,c),s.updateCounter(_,c)}async function k(){const t=document.getElementById("input_username_auth"),e=document.getElementById("input_password_auth"),o=t.value,a=e.value;if(""===o||""===a)return;const i=await n.get();let c=!1,r=!1;if(i.forEach((t=>{!0!==c&&t.name===o&&(c=!0,a===t.password?(d=t.id,r=!0):e.value="")})),!1!==r){if(!1===c)return t.value="",void(e.value="");await w(),t.value="",e.value="",s.changeAuthStatusLogIn(o),l.modalWindow.hide()}}async function L(){const t=document.getElementById("input_username_reg"),e=document.getElementById("input_password_reg"),s=t.value,o=e.value;if(""===s||""===o)return;const i=await n.get();let d=!1;if(i.forEach((t=>{t.name===s&&(d=!0)})),d)return void(t.value="");const c=new a("",s,o),l=(await n.post(c)).name,u=new a(l,s,o);await n.update(u.id,u),t.value="",e.value="",r.modalWindow.hide()}window.addEventListener("load",w),u.addEventListener("click",(function(){const t=document.querySelector(`.${l.btnName}`);l.modalWindow.show(),t.addEventListener("click",k)})),m.addEventListener("click",(function(){const t=document.querySelector(`.${r.btnName}`);r.modalWindow.show(),t.addEventListener("click",L)})),p.addEventListener("click",(async function(){d=i,s.changeAuthStatusLogOut(),await w()})),b.addEventListener("submit",(async function(n){if(n.preventDefault(),""===this.description.value)return;const o=new t("",this.description.value,!1),a=(await e.post(d,o)).name,i=new t(a,this.description.value,!1);await e.update(d,a,i),c.set(a,i),console.log(c),s.showTasks(f,g,y,h,c),s.updateCounter(_,c),this.reset()})),v.addEventListener("click",(function(){h.childNodes.forEach((t=>{const n=t.querySelector(".task_text"),s=t.querySelector(".task_status");!1===c.get(t.id).status&&n.classList.toggle("done")&&(c.get(t.id).status=!0,e.update(d,t.id,c.get(t.id)),s.checked=!0)})),s.showTasks(f,g,y,h,c),s.updateCounter(_,c)})),f.addEventListener("click",(()=>{s.showTasks(f,g,y,h,c)})),g.addEventListener("click",(()=>{s.showTasks(f,g,y,h,c)})),y.addEventListener("click",(()=>{s.showTasks(f,g,y,h,c)})),E.addEventListener("click",(function(){h.childNodes.forEach((t=>{if(!0===c.get(t.id).status){let n=t.querySelector(".delete_btn"),s=n.cloneNode(!0);n.parentNode.replaceChild(s,n),e.delete(d,t.id),c.delete(t.id)}})),s.showTasks(f,g,y,h,c),s.updateCounter(_,c)})),h.addEventListener("click",(function(t){const n=t.target,o=n.parentNode;if("task_status"===n.className){const t=o.querySelector(".task_text"),s=o.querySelector(".task_status");t.classList.toggle("done")?(c.get(n.id).status=!0,s.checked=!0):(c.get(n.id).status=!1,s.checked=!1),e.update(d,n.id,c.get(n.id))}s.showTasks(f,g,y,h,c),s.updateCounter(_,c)})),h.addEventListener("click",(function(t){const n=t.target,o=n.parentNode.parentNode;if("delete_btn"===n.className){let t=o.querySelector(".delete_btn"),n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),c.delete(o.id),e.delete(d,o.id),o.remove()}s.showTasks(f,g,y,h,c),s.updateCounter(_,c)}))})();